<!DOCTYPE html>
<html>
<head>
  <title>小塔在干嘛喵</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    

    /* 其他保持原有样式 */
    

    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    #map {
      width: 100vw;
      height: 100vh;
      background: url('map.jpg') no-repeat center/cover;
      position: relative;
    }

    /* 双图层容器 */
    
    .character-container {
      position: absolute;
      transition: all 0.5s ease;
      width: 100px;                               /* 容器与图片同尺寸 */
      height: 100px;
    }

    /* 移动时显示的角色 */
    
    #moving-character {
      background-size: 100% 100%;
      width: 100px;
      height: 100px;
      background: url('person.jpg') no-repeat center/contain;
      position: absolute;
    }

    /* 到达后固定的角色 */
    .fixed-character {
      width: 50px;
      height: 50px;
      position: absolute;
      opacity: 0;
      transition: opacity 0.3s;
    }

    /* 四个位置的固定图片 */
    .location1 .fixed-character { background-image: url('a.jpg'); }
    .location2 .fixed-character { background-image: url('b.jpg'); }
    .location3 .fixed-character { background-image: url('c.jpg'); }
    .location4 .fixed-character { background-image: url('d.jpg'); }

    /* 位置坐标 */
    .location1 { left: 15%; top: 30%; }
    .location2 { left: 70%; top: 45%; }
    .location3 { left: 40%; top: 60%; }
    .location4 { left: 55%; top: 20%; }
    /* 管理员面板 */
    #adminPanel {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="map">
    <div class="character-container location1" id="character">
      <div id="moving-character"></div>
      <div class="fixed-character"></div>
    </div>
  </div>

  <!-- 管理员面板保持不变 -->

  <script>
    // Firebase配置
    const firebaseConfig = {
      apiKey: "AIzaSyAIe2Th7xdexrh1ZhnxCuH-or8mspMYpDk",
      authDomain: "tartarus-3e705.firebaseapp.com",
      databaseURL: "https://tartarus-3e705-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "tartarus-3e705",
      storageBucket: "tartarus-3e705.firebasestorage.app",
      messagingSenderId: "192253876792",
      appId: "1:192253876792:web:56ff2effe68b2b1aaa64cd",
      measurementId: "G-36QLSB4CFQ"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 动画状态控制
    let isMoving = false;
    let currentLocation = 'location1';
    const container = document.getElementById('character');
    const movingChar = document.getElementById('moving-character');
    const fixedChar = document.querySelector('.fixed-character');

    database.ref('location').on('value', (snapshot) => {
      const newLocation = snapshot.val() || 'location1';
      
      if (newLocation !== currentLocation) {
        isMoving = true;
        
        // 开始移动：显示过程动画
        movingChar.style.opacity = '1';
        fixedChar.style.opacity = '0';
        
        // 更新位置
        container.className = `character-container ${newLocation}`;
        
        // 监听动画结束
        container.addEventListener('transitionend', () => {
          // 到达后切换显示
          movingChar.style.opacity = '0';
          fixedChar.style.opacity = '1';
          isMoving = false;
          currentLocation = newLocation;
        }, { once: true });
      }
    });

    // 初始化显示
    fixedChar.style.opacity = '1';
    // 预加载所有图片
    function preloadImages() {
      const images = ['person.jpg', ...Object.values(locationImages)];
      images.forEach(src => new Image().src = src);
    }
    window.onload = preloadImages;

    // 管理员更新位置
    function updateLocation() {
      const password = prompt("请输入管理员密码:");
      if (password !== "OOO") return;

      const selectedLocation = document.getElementById('location').value;
      database.ref('location').set(selectedLocation);
    }

    // 显示管理员界面
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('admin') === 'true') {
      document.getElementById('adminPanel').style.display = 'block';
    }
  </script>
</body>
</html>